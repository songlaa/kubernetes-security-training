<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Exposing a service | Kubernetes Security Training</title>
<meta name=description content="In this lab, we are going to make the frontend from the last lab available online.
Task 1.3.1: Create a ClusterIP Service The command kubectl apply -f deployment_example-frontend.yaml from the last lab creates a Deployment but no Service.
A kubernetes Service is an abstract way to expose an application running on a set of Pods as a network service. For some parts of your application (for example, frontends) you may want to expose a Service to an external IP address which is outside your cluster."><meta property="og:title" content="Exposing a service"><meta property="og:description" content="In this lab, we are going to make the frontend from the last lab available online.
Task 1.3.1: Create a ClusterIP Service The command kubectl apply -f deployment_example-frontend.yaml from the last lab creates a Deployment but no Service.
A kubernetes Service is an abstract way to expose an application running on a set of Pods as a network service. For some parts of your application (for example, frontends) you may want to expose a Service to an external IP address which is outside your cluster."><meta property="og:type" content="article"><meta property="og:url" content="/docs/kubernetes-basics/01-basics/01/_service/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-09-26T23:24:37+02:00"><meta itemprop=name content="Exposing a service"><meta itemprop=description content="In this lab, we are going to make the frontend from the last lab available online.
Task 1.3.1: Create a ClusterIP Service The command kubectl apply -f deployment_example-frontend.yaml from the last lab creates a Deployment but no Service.
A kubernetes Service is an abstract way to expose an application running on a set of Pods as a network service. For some parts of your application (for example, frontends) you may want to expose a Service to an external IP address which is outside your cluster."><meta itemprop=dateModified content="2024-09-26T23:24:37+02:00"><meta itemprop=wordCount content="1221"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Exposing a service"><meta name=twitter:description content="In this lab, we are going to make the frontend from the last lab available online.
Task 1.3.1: Create a ClusterIP Service The command kubectl apply -f deployment_example-frontend.yaml from the last lab creates a Deployment but no Service.
A kubernetes Service is an abstract way to expose an application running on a set of Pods as a network service. For some parts of your application (for example, frontends) you may want to expose a Service to an external IP address which is outside your cluster."><link rel=preload href=/scss/main.min.489e156ad05e59efb10d446a42479e2d14bcbdc7388c5c52fb2c6dcbe204b264.css as=style><link href=/scss/main.min.489e156ad05e59efb10d446a42479e2d14bcbdc7388c5c52fb2c6dcbe204b264.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Kubernetes Security Training</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/setup/><span>Setup</span></a></li><li class=nav-item><a class=nav-link href=/slides/><span>Slides</span></a></li><li class=nav-item><a class=nav-link href=https://www.songlaa.com target=_blank rel=noopener><span>songlaa gmbh</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Labs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docskubernetes-basics01-basics-li><a href=/docs/kubernetes-basics/01-basics/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docskubernetes-basics01-basics><span>1. 1. Basics</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics01-basics01_introduction-li><a href=/docs/kubernetes-basics/01-basics/01/_introduction/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics01-basics01_introduction><span>1.1. Introduction</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics01-basics01_deployments-li><a href=/docs/kubernetes-basics/01-basics/01/_deployments/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics01-basics01_deployments><span>1.2. Deployments</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docskubernetes-basics01-basics01_service-li><a href=/docs/kubernetes-basics/01-basics/01/_service/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics01-basics01_service><span class=td-sidebar-nav-active-item>1.3. Exposing a service</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics01-basics01_database-li><a href=/docs/kubernetes-basics/01-basics/01/_database/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics01-basics01_database><span>1.4. Backend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics01-basics01_sec-frontend-li><a href=/docs/kubernetes-basics/01-basics/01/_sec-frontend/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics01-basics01_sec-frontend><span>1.5. Securing the frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics01-basics01_network-policies-li><a href=/docs/kubernetes-basics/01-basics/01/_network-policies/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics01-basics01_network-policies><span>1.6. Network Policies</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics01-basics01_rbac-li><a href=/docs/kubernetes-basics/01-basics/01/_rbac/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics01-basics01_rbac><span>1.7. RBAC</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics01-basics01_psa-li><a href=/docs/kubernetes-basics/01-basics/01/_psa/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics01-basics01_psa><span>1.8. PSA</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docskubernetes-basics02-security-li><a href=/docs/kubernetes-basics/02-security/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docskubernetes-basics02-security><span>2. 2. Securing Kubernetes</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics02-security02_architecture-li><a href=/docs/kubernetes-basics/02-security/02/_architecture/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics02-security02_architecture><span>2.1. Architecture and encryption</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics02-security02_custom-policies-li><a href=/docs/kubernetes-basics/02-security/02/_custom-policies/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics02-security02_custom-policies><span>2.2. Custom Policies</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docskubernetes-basics02-security02_runtime-sec-li><a href=/docs/kubernetes-basics/02-security/02/_runtime-sec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docskubernetes-basics02-security02_runtime-sec><span>2.3. Runtime Security</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/songlaa/kubernetes-security-training/tree/main/content/en/docs/kubernetes-basics/01-Basics/01/_service.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/songlaa/kubernetes-security-training/edit/main/content/en/docs/kubernetes-basics/01-Basics/01/_service.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/songlaa/kubernetes-security-training/new/main/content/en/docs/kubernetes-basics/01-Basics/01?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/songlaa/kubernetes-security-training/issues/new?title=Exposing%20a%20service" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#task-131-create-a-clusterip-service>Task 1.3.1: Create a ClusterIP Service</a></li><li><a href=#task-132-expose-the-service>Task 1.3.2: Expose the Service</a></li><li><a href=#task-133-expose-as-nodeport>Task 1.3.3: Expose as NodePort</a></li><li><a href=#task-134-for-fast-learners>Task 1.3.4: For fast learners</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Labs</a></li><li class=breadcrumb-item><a href=/docs/kubernetes-basics/01-basics/>1. Basics</a></li><li class="breadcrumb-item active" aria-current=page>Exposing a service</li></ol></nav><div class=td-content><h1>1.3. Exposing a service</h1><header class=article-meta></header><p>In this lab, we are going to make the frontend from the last lab available online.</p><h2 id=task-131-create-a-clusterip-service>Task 1.3.1: Create a ClusterIP Service</h2><p>The command <code>kubectl apply -f deployment_example-frontend.yaml</code> from the last lab creates a Deployment but no Service.</p><p>A kubernetes Service is an abstract way to expose an application running on a set of Pods as a network service. For some parts of your application (for example, frontends) you may want to expose a Service to an external IP address which is outside your cluster.</p><p>kubernetes <code>ServiceTypes</code> allow you to specify what kind of Service you want. The default is <code>ClusterIP</code>.</p><p><code>Type</code> values and their behaviors are:</p><ul><li><p><code>ClusterIP</code>: Exposes the Service on a cluster-internal IP. Choosing this value only makes the Service reachable from within the cluster. This is the default ServiceType.</p></li><li><p><code>NodePort</code>: Exposes the Service on each Node&rsquo;s IP at a static port (the NodePort). A ClusterIP Service, to which the NodePort Service routes, is automatically created. You&rsquo;ll be able to contact the NodePort Service from outside the cluster, by requesting &lt;NodeIP>:&lt;NodePort>.</p></li><li><p><code>LoadBalancer</code>: Exposes the Service externally using a cloud provider&rsquo;s load balancer. NodePort and ClusterIP Services, to which the external load balancer routes, are automatically created.</p></li><li><p><code>ExternalName</code>: Maps the Service to the contents of the externalName field (e.g. foo.bar.example.com), by returning a CNAME record with its value. No proxying of any kind is set up.</p></li></ul><p>You can also use Ingress to expose your Service.</p><p>Ingress is not a Service type, but it acts as the entry point for your cluster. <a href=https://kubernetes.io/docs/concepts/services-networking/ingress/ target=_blank rel=noopener>Ingress</a>
exposes HTTP and HTTPS routes from outside the cluster to services within the cluster.
Traffic routing is controlled by rules defined on the Ingress resource. An Ingress may be configured to give Services externally reachable URLs, load balance traffic, terminate SSL / TLS, and offer name-based virtual hosting. An Ingress controller is responsible for fulfilling the route, usually with a load balancer, though it may also configure your edge router or additional frontends to help handle the traffic.</p><p>In order to create an Ingress, we first need to create a Service of type <a href=https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types target=_blank rel=noopener>ClusterIP</a>
.</p><p>To create the Service add a new file <code>svc-frontend.yaml</code> with the following content:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TCP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterIP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>And then apply the file with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f svc-frontend.yaml --namespace &lt;namespace&gt;
</span></span></code></pre></div><p>There is also am imperative command to create a service and expose your application which can be used instead of the yaml file with the <code>kubectl apply ...</code> command</p><pre tabindex=0><code>kubectl expose deployment example-frontend --type=ClusterIP --name=example-frontend --port=5000 --target-port=5000 --namespace &lt;namespace&gt;
</code></pre><p>Let&rsquo;s have a more detailed look at our Service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get services --namespace &lt;namespace&gt;
</span></span></code></pre></div><p>Which gives you an output similar to this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME             TYPE       CLUSTER-IP    EXTERNAL-IP   PORT<span style=color:#ce5c00;font-weight:700>(</span>S<span style=color:#ce5c00;font-weight:700>)</span>        AGE
</span></span><span style=display:flex><span>example-frontend   ClusterIP  10.43.91.62   &lt;none&gt;        5000/TCP
</span></span></code></pre></div><div class="alert alert-info" role=alert><h4 class=alert-heading>Note</h4>Service IP (CLUSTER-IP) addresses stay the same for the duration of the Service&rsquo;s lifespan.</div><p>By executing the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get service example-frontend -o yaml --namespace &lt;namespace&gt;
</span></span></code></pre></div><p>You get additional information:</p><pre tabindex=0><code>apiVersion: v1
kind: Service
metadata:
  ...
  labels:
    app: example-frontend
  managedFields:
    ...
  name: example-frontend
  namespace: &lt;namespace&gt;
  ...
spec:
  clusterIP: 10.43.91.62
  externalTrafficPolicy: Cluster
  ports:
  - port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: example-frontend
  sessionAffinity: None
  type: ClusterIP
status:
  loadBalancer: {}
</code></pre><p>The Service&rsquo;s <code>selector</code> defines which Pods are being used as Endpoints. This happens based on labels. Look at the configuration of Service and Pod in order to find out what maps to what:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get service example-frontend -o yaml --namespace &lt;namespace&gt;
</span></span></code></pre></div><pre tabindex=0><code>...
  selector:
    app: example-frontend
...
</code></pre><p>With the following command you get details from the Pod:</p><div class="alert alert-info" role=alert><h4 class=alert-heading>Note</h4>First, get all Pod names from your namespace with (<code>kubectl get pods --namespace &lt;namespace></code>) and then replace &lt;pod> in the following command. If you have installed and configured the bash completion, you can also press the TAB key for autocompletion of the Pod&rsquo;s name.</div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pod &lt;pod&gt; -o yaml --namespace &lt;namespace&gt;
</span></span></code></pre></div><p>Let&rsquo;s have a look at the label section of the Pod and verify that the Service selector matches the Pod&rsquo;s labels:</p><pre tabindex=0><code>...
  labels:
    app: example-frontend
...
</code></pre><p>This link between Service and Pod can also be displayed in an easier fashion with the <code>kubectl describe</code> command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe service example-frontend --namespace &lt;namespace&gt;
</span></span></code></pre></div><pre tabindex=0><code>Name:                     example-frontend
Namespace:                example-ns
Labels:                   app=example-frontend
Annotations:              &lt;none&gt;
Selector:                 app=example-frontend
Type:                     ClusterIP
IP:                       10.39.240.212
Port:                     &lt;unset&gt;  5000/TCP
TargetPort:               5000/TCP
Endpoints:                10.36.0.8:5000
Session Affinity:         None
External Traffic Policy:  Cluster
Events:
  Type    Reason                Age    From                Message
  ----    ------                ----   ----                -------
</code></pre><p>The <code>Endpoints</code> show the IP addresses of all currently matched Pods.</p><h2 id=task-132-expose-the-service>Task 1.3.2: Expose the Service</h2><p>With the ClusterIP Service ready, we can now create the Ingress resource.
In order to create the Ingress resource, we first need to create the file <code>ing-example-frontend.yaml</code> and change the <code>host</code> entry to match your environment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>networking.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Ingress</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-frontend-&lt;namespace&gt;.&lt;appdomain&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>paths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>pathType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Prefix</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>backend</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>service</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>number</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>example-frontend-&lt;namespace&gt;.&lt;appdomain&gt;</span></span></span></code></pre></div><p>As you see in the resource definition at <code>spec.rules[0].http.paths[0].backend.service.name</code> we use the previously created <code>example-frontend</code> ClusterIP Service.</p><p>Let&rsquo;s create the Ingress resource with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f ing-example-frontend.yaml --namespace &lt;namespace&gt;
</span></span></code></pre></div><p>Afterwards, we are able to access our freshly created Ingress at <code>http://example-frontend-&lt;namespace>.&lt;appdomain></code></p><h2 id=task-133-expose-as-nodeport>Task 1.3.3: Expose as NodePort</h2><div class="alert alert-info" role=alert><h4 class=alert-heading>Note</h4><p>This is an advanced lab, so feel free to skip this. NodePorts are usually not used for http-based applications as we use the layer 7-based Ingress resource. Only for non-http based applications, a NodePort might be a suitable alternative.</p></div><p>There&rsquo;s a second option to make a Service accessible from outside: Use a <a href=https://kubernetes.io/docs/concepts/services-networking/service/#nodeport target=_blank rel=noopener>NodePort</a>
.</p><p>In order to switch the Service type, change the existing <code>ClusterIP</code> Service by updating our Service definition in file <code>svc-frontend.yaml</code>to:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TCP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5000</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>example-frontend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NodePort</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>And then apply again with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f svc-frontend.yaml --namespace &lt;namespace&gt;
</span></span></code></pre></div><p>Let&rsquo;s have a more detailed look at our new <code>NodePort</code> Service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get services --namespace &lt;namespace&gt;
</span></span></code></pre></div><p>Which gives you an output similar to this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME             TYPE       CLUSTER-IP    EXTERNAL-IP   PORT<span style=color:#ce5c00;font-weight:700>(</span>S<span style=color:#ce5c00;font-weight:700>)</span>        AGE
</span></span><span style=display:flex><span>example-frontend   NodePort   10.43.91.62   &lt;none&gt;        5000:30692/TCP
</span></span></code></pre></div><p>The <code>NodePort</code> number is assigned by Kubernetes and stays the same as long as the Service is not deleted. A NodePort Service is more suitable for infrastructure tools than for public URLs.</p><p>Open <code>http://&lt;node-ip>:&lt;node-port></code> in your browser or use <code>curl http://&lt;node-ip>:&lt;node-port></code> when the public ip is not available in your browser.
You can use any node IP as the Service is exposed on all nodes using the same <code>NodePort</code>. Use <code>kubectl get nodes -o wide</code> to display the IPs (<code>INTERNAL-IP</code> or <code>EXTERNAL-IP</code>) of the available nodes. Depending on your environment, use the internal or external (public) ip address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get node -o wide
</span></span></code></pre></div><p>The output may vary depending on your setup:</p><pre tabindex=0><code>NAME         STATUS   ROLES                      AGE    VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
lab-1   Ready    controlplane,etcd,worker   150m   v1.17.4   5.102.145.142   &lt;none&gt;        Ubuntu 18.04.3 LTS   4.15.0-66-generic   docker://19.3.8
lab-2   Ready    controlplane,etcd,worker   150m   v1.17.4   5.102.145.77    &lt;none&gt;        Ubuntu 18.04.3 LTS   4.15.0-66-generic   docker://19.3.8
lab-3   Ready    controlplane,etcd,worker   150m   v1.17.4   5.102.145.148   &lt;none&gt;        Ubuntu 18.04.3 LTS   4.15.0-66-generic   docker://19.3.8
</code></pre><h2 id=task-134-for-fast-learners>Task 1.3.4: For fast learners</h2><p>Have a closer look at the resources created in your namespace <code>&lt;namespace></code> with the following commands and try to understand them:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe namespace &lt;namespace&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get all --namespace &lt;namespace&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe &lt;resource&gt; &lt;name&gt; --namespace &lt;namespace&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get &lt;resource&gt; &lt;name&gt; -o yaml --namespace &lt;namespace&gt;
</span></span></code></pre></div><div class="text-muted mt-5 pt-3"><div class=row><div class=col-sm><a href=/docs/kubernetes-basics/01-basics/01/_deployments/ data-toggle=tooltip title=Deployments><i class="fa fa-arrow-circle-left"></i> Previous</a></div><div class="col-sm text-right"><a href=/docs/kubernetes-basics/01-basics/01/_database/ data-toggle=tooltip title=Backend>Next <i class="fa fa-arrow-circle-right"></i></a></div></div></div><div class=td-page-meta__lastmod>Last modified September 26, 2024: <a href=https://github.com/songlaa/kubernetes-security-training/commit/b7c2f16094a31532b178095681c3f41c7036cade>add backend lab/rename frontend app (b7c2f16)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=LinkedIn aria-label=LinkedIn><a target=_blank rel=noopener href=https://linkedin.com/gabriel-graf-6b6446319/ aria-label=LinkedIn><i class="fab fa-linkedin-in"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/songlaa/kubernetes-security-training aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>songlaa gmbh</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.d05ad35ff2c6dc165933414181dc1f183f98fc42e97d00f21d8d3d73d13ab4e1.js integrity="sha256-0FrTX/LG3BZZM0FBgdwfGD+Y/ELpfQDyHY09c9E6tOE=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script><script src=/js/site.min.1b86eee028c038e3c091bb0e4a5f11d864071cfddfac37a5b7d7dc4b7af9bd0a.js integrity="sha256-G4bu4CjAOOPAkbsOSl8R2GQHHP3frDelt9fcS3r5vQo=" crossorigin=anonymous></script></body></html>